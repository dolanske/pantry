{"version":3,"file":"pantry.js","sources":["../src/link.ts","../src/pantry.ts"],"sourcesContent":["import type { Children } from '@dolanske/cascade'\nimport { El } from '@dolanske/cascade'\nimport { navigate } from '@dolanske/crumbs'\n\nexport function RouterLink(href: string, text: Children) {\n  return El.a().setup((component) => {\n    component.attr('href', href)\n    component.nest(text)\n    component.click((event) => {\n      event.preventDefault()\n      navigate(href)\n    })\n  })\n}\n","import type { Route as CrumbRoute, Router as CrumbRouter } from '@dolanske/crumbs'\nimport { defineRouter, onRouteError, onRouteResolve } from '@dolanske/crumbs'\nimport { Component } from '@dolanske/cascade'\n\n/**\n * TODO\n *\n * [] Add loaderFallback to Route interface\n * [] Rename fallback in Route interface to errorFallback\n * REVIEW\n * [x] Add globalError fallback\n *  - will render on any route error, unless the route has its own errorFallback\n */\n\nfunction noop() { }\n\nexport interface Route {\n  component: Component\n  loader?: CrumbRoute['loader']\n  title?: CrumbRoute['title']\n  default?: CrumbRoute['default']\n  fallback?: Component\n}\n\nexport interface LoaderProps<D> {\n  $params: Record<string, string>\n  $data: D\n}\n\nexport type PropType<LoaderData, ComponentProps extends object = object> = LoaderProps<LoaderData> & ComponentProps\n\ntype Router = Record<string, Route | Component>\n\nexport function createApp(routes: Router) {\n  const RouterViews: Record<string, Component> = {}\n  const RouteFallbacks: Record<string, Component> = {}\n  const CrumbsRouter: CrumbRouter = {}\n\n  // Serialize base application routes into what crumbs can consume\n  for (const [path, route] of Object.entries(routes)) {\n    // This router is generic, built for HTML, so within Cascade, we just need to\n    // mimic the router paths with an emty div as a router wrapper\n    const html = '<div route-boundary>'\n    if (route instanceof Component) {\n      RouterViews[path] = route\n      CrumbsRouter[path] = {\n        html,\n      }\n    }\n    else {\n      const { loader, title, default: _default, fallback, component } = route\n      RouterViews[path] = component\n      CrumbsRouter[path] = {\n        loader,\n        title,\n        default: _default,\n        html,\n      }\n\n      if (fallback)\n        RouteFallbacks[path] = fallback\n    }\n  }\n\n  const router = defineRouter(CrumbsRouter)\n\n  // Store stopper between `run` and `stop` handlers\n  let onResolveRelease = noop\n  let onErrorRelease = noop\n\n  let prevView: Component | undefined\n  let prevFallback: Component | undefined\n  let globalErrorFallback: Component | undefined\n\n  return {\n    run: (selector: string) => {\n      // Watch for when new route is navigated into and then render Cascade app into its wrapper\n      onResolveRelease = onRouteResolve((route) => {\n        if (prevView)\n          prevView.destroy()\n\n        const newView = RouterViews[route.path]\n        if (newView) {\n          const view = newView.clone()\n          // If route contained a loader, set the data as a prop\n          view.props({\n            $data: route.data,\n            $params: route.params,\n          })\n\n          view.mount('[route-boundary]')\n          prevView = view\n        }\n      })\n\n      onErrorRelease = onRouteError((route, error) => {\n        let newFallback: Component | undefined\n\n        if (prevFallback)\n          prevFallback.destroy()\n\n        if (!route) {\n          console.warn('Attempted to navigate to a route that does not exist')\n          console.error(error)\n          newFallback = globalErrorFallback\n        }\n        else {\n          newFallback = RouteFallbacks[route.path]\n        }\n\n        if (newFallback) {\n          const fallback = newFallback.clone()\n\n          fallback.mount('route-boundary')\n          prevFallback = fallback\n        }\n      })\n\n      router.run(selector)\n    },\n    stop: () => {\n      router.stop()\n      onResolveRelease()\n      onErrorRelease()\n      if (prevView)\n        prevView.destroy()\n      if (prevFallback)\n        prevFallback.destroy()\n    },\n    errorFallback: (component: Component) => {\n      globalErrorFallback = component\n    },\n  }\n}\n"],"names":["RouterLink","href","text","El","component","event","navigate","noop","createApp","routes","RouterViews","RouteFallbacks","CrumbsRouter","path","route","html","Component","loader","title","_default","fallback","router","defineRouter","onResolveRelease","onErrorRelease","prevView","prevFallback","globalErrorFallback","selector","onRouteResolve","newView","view","onRouteError","error","newFallback"],"mappings":";;;;AAIgB,SAAAA,EAAWC,GAAcC,GAAgB;AACvD,SAAOC,EAAG,EAAA,EAAI,MAAM,CAACC,MAAc;AACvB,IAAAA,EAAA,KAAK,QAAQH,CAAI,GAC3BG,EAAU,KAAKF,CAAI,GACTE,EAAA,MAAM,CAACC,MAAU;AACzB,MAAAA,EAAM,eAAe,GACrBC,EAASL,CAAI;AAAA,IAAA,CACd;AAAA,EAAA,CACF;AACH;ACCA,SAASM,IAAO;AAAE;AAmBX,SAASC,EAAUC,GAAgB;AACxC,QAAMC,IAAyC,CAAA,GACzCC,IAA4C,CAAA,GAC5CC,IAA4B,CAAA;AAGlC,aAAW,CAACC,GAAMC,CAAK,KAAK,OAAO,QAAQL,CAAM,GAAG;AAGlD,UAAMM,IAAO;AACb,QAAID,aAAiBE;AACnB,MAAAN,EAAYG,CAAI,IAAIC,GACpBF,EAAaC,CAAI,IAAI;AAAA,QACnB,MAAAE;AAAA,MAAA;AAAA,SAGC;AACH,YAAM,EAAE,QAAAE,GAAQ,OAAAC,GAAO,SAASC,GAAU,UAAAC,GAAU,WAAAhB,EAAc,IAAAU;AAClE,MAAAJ,EAAYG,CAAI,IAAIT,GACpBQ,EAAaC,CAAI,IAAI;AAAA,QACnB,QAAAI;AAAA,QACA,OAAAC;AAAA,QACA,SAASC;AAAA,QACT,MAAAJ;AAAA,MAAA,GAGEK,MACFT,EAAeE,CAAI,IAAIO;AAAA,IAC3B;AAAA,EACF;AAEM,QAAAC,IAASC,EAAaV,CAAY;AAGxC,MAAIW,IAAmBhB,GACnBiB,IAAiBjB,GAEjBkB,GACAC,GACAC;AAEG,SAAA;AAAA,IACL,KAAK,CAACC,MAAqB;AAEN,MAAAL,IAAAM,EAAe,CAACf,MAAU;AACvC,QAAAW,KACFA,EAAS,QAAQ;AAEb,cAAAK,IAAUpB,EAAYI,EAAM,IAAI;AACtC,YAAIgB,GAAS;AACL,gBAAAC,IAAOD,EAAQ;AAErB,UAAAC,EAAK,MAAM;AAAA,YACT,OAAOjB,EAAM;AAAA,YACb,SAASA,EAAM;AAAA,UAAA,CAChB,GAEDiB,EAAK,MAAM,kBAAkB,GAClBN,IAAAM;AAAA,QACb;AAAA,MAAA,CACD,GAEgBP,IAAAQ,EAAa,CAAClB,GAAOmB,MAAU;AAC1C,YAAAC;AAcJ,YAZIR,KACFA,EAAa,QAAQ,GAElBZ,IAMWoB,IAAAvB,EAAeG,EAAM,IAAI,KALvC,QAAQ,KAAK,sDAAsD,GACnE,QAAQ,MAAMmB,CAAK,GACLC,IAAAP,IAMZO,GAAa;AACT,gBAAAd,IAAWc,EAAY;AAE7B,UAAAd,EAAS,MAAM,gBAAgB,GAChBM,IAAAN;AAAA,QACjB;AAAA,MAAA,CACD,GAEDC,EAAO,IAAIO,CAAQ;AAAA,IACrB;AAAA,IACA,MAAM,MAAM;AACV,MAAAP,EAAO,KAAK,GACKE,KACFC,KACXC,KACFA,EAAS,QAAQ,GACfC,KACFA,EAAa,QAAQ;AAAA,IACzB;AAAA,IACA,eAAe,CAACtB,MAAyB;AACjB,MAAAuB,IAAAvB;AAAA,IACxB;AAAA,EAAA;AAEJ;"}